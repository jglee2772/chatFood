<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LunchBot ë¡œê·¸ì¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/login.css">
</head>

<body>

<!-- â˜€ï¸ ì›€ì§ì´ëŠ” í–‡ì‚´ íš¨ê³¼ -->
<div class="light-glow"></div>

<!-- ğŸŒ«ï¸ ë¶€ë“œëŸ¬ìš´ ëƒ„ìƒˆ íš¨ê³¼ -->
<div class="steam"></div>
<div class="steam"></div>
<div class="steam"></div>

<!-- ğŸ  í™ˆ ì´ë™ ë²„íŠ¼ -->
<div class="home-btn" onclick="window.location.href='/'">ğŸ </div>

<!-- ğŸ£ ì™¼ìª½ ìŒì‹ ì•„ì´ì½˜ -->
<div class="side-left">
    <img src="/img/ê¹€ì¹˜ì°Œê²Œ.png" alt="ê¹€ì¹˜ì°Œê²Œ" />
    <img src="/img/í”¼ì.png" alt="í”¼ì" />
    <img src="/img/íƒ€ì½”.png" alt="íƒ€ì½”" />
</div>

<!-- ğŸ§¡ ë¡œê·¸ì¸ ë°•ìŠ¤ -->
<div class="login-container">
    <h1>LunchBot ë¡œê·¸ì¸</h1>
    <p class="subtitle">AIê°€ ë‹¹ì‹ ì˜ ì ì‹¬ ë©”ë‰´ë¥¼ ë„ì™€ë“œë¦´ê²Œìš” ğŸ±</p>

    <form id="loginForm" onsubmit="handleLogin(); return false;">
        <div class="input-group">
            <label for="email">ì´ë©”ì¼</label>
            <input type="email" id="email" name="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>

        <div class="input-group">
            <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>

        <button type="submit" class="login-btn">ë¡œê·¸ì¸</button>
    </form>

    <div class="footer-link">
        ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a href="/signup">íšŒì›ê°€ì…í•˜ê¸°</a>
    </div>

    <div class="bottom-illustration">
        <img src="/img/ë„ì‹œë½.png" alt="ë„ì‹œë½">
        <div class="bottom-text">ì˜¤ëŠ˜ë„ ë§›ìˆëŠ” ì ì‹¬ì‹œê°„ ë˜ì„¸ìš”!</div>
    </div>
</div>

<!-- ğŸ• ì˜¤ë¥¸ìª½ ìŒì‹ ì•„ì´ì½˜ -->
<div class="side-right">
    <img src="/img/ë„ì‹œë½.png" alt="ë„ì‹œë½" />
    <img src="/img/ëˆê¹ŒìŠ¤.png" alt="ëˆê¹ŒìŠ¤" />
    <img src="/img/ìŠ¤í…Œì´í¬.png" alt="ìŠ¤í…Œì´í¬" />
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    // ë¡œê·¸ì¸ ì²˜ë¦¬
    function handleLogin() {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;

        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        const loginBtn = document.querySelector('.login-btn');
        const originalText = loginBtn.textContent;
        loginBtn.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
        loginBtn.disabled = true;

        // ë¡œê·¸ì¸ API í˜¸ì¶œ
        axios.post('/api/users/login', {
            email: email,
            password: password
        })
        .then(response => {
            if (response.data.success) {
                // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
                sessionStorage.setItem('userId', response.data.userId);
                sessionStorage.setItem('userName', response.data.name);
                sessionStorage.setItem('userEmail', email);
                
                alert('ğŸ‰ ' + response.data.name + 'ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!');
                window.location.href = '/chatFood';
            } else {
                alert('âŒ ' + response.data.message);
                loginBtn.textContent = originalText;
                loginBtn.disabled = false;
            }
        })
        .catch(error => {
            if (error.response && error.response.data && error.response.data.message) {
                alert('âŒ ' + error.response.data.message);
            } else {
                alert('âŒ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
            loginBtn.textContent = originalText;
            loginBtn.disabled = false;
        });
    }
</script>
</body>
</html>
