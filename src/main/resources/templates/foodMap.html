<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/foodMap.css">
    <title>ë§›ì§‘ ì§€ë„ - LunchBot</title>
    <!-- REST API ì‚¬ìš© - JavaScript API ì œê±° -->
</head>
<body>

    <header>
        <div class="header-container">
            <p>LunchBot ì˜¤ëŠ˜ ë­ ë¨¹ì„ê¹Œ?</p>
            <div class="input-group">
                <label for="search-food">ìŒì‹ ê²€ìƒ‰</label>
                <input type="text" id="search-food" name="search-food" placeholder="ìŒì‹/ì¥ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <button id="search-btn" class="search-btn">ê²€ìƒ‰</button>
            </div>
        </div>
    </header>

    <div class="main-wrapper">
        <div class="main-content">
            <div class="upper-content">
                <div class="upper-map" id="map">
                    <!-- ë„¤ì´ë²„ ì§€ë„ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            <div class="lower-content">
                <div class="short-info" id="search-result">
                    <h4>ê²€ìƒ‰ ê²°ê³¼</h4>
                    <p>ìŒì‹ì´ë‚˜ ì¥ì†Œë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”!</p>
                </div>
                <div class="short-info" id="place-info">
                    <h4>ì¥ì†Œ ì •ë³´</h4>
                    <p>ì§€ë„ì—ì„œ ì¥ì†Œë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
                </div>
            </div>
        </div>
        <div class="right-side-content">

        </div>
    </div>
    
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    // REST API ë°©ì‹ìœ¼ë¡œ ì§€ë„ í‘œì‹œ
    document.addEventListener('DOMContentLoaded', function() {
        // ì§€ë„ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
        initMapDisplay();
        
        // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('search-btn').addEventListener('click', searchFood);
        
        // ì—”í„°í‚¤ë¡œ ê²€ìƒ‰
        document.getElementById('search-food').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchFood();
            }
        });
    });

    // ì§€ë„ í‘œì‹œ ì´ˆê¸°í™” (REST API ë°©ì‹)
    function initMapDisplay() {
        const mapContainer = document.getElementById('map');
        mapContainer.innerHTML = `
            <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; display: flex; align-items: center; justify-content: center; color: white; text-align: center; position: relative;">
                <div>
                    <h3 style="margin-bottom: 20px; font-size: 24px;">ğŸ—ºï¸ ë§›ì§‘ ì§€ë„</h3>
                    <p style="margin-bottom: 15px;">ìŒì‹ì´ë‚˜ ì¥ì†Œë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”!</p>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <div style="background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 20px; font-size: 14px;">
                            ğŸ“ ê²€ìƒ‰
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 20px; font-size: 14px;">
                            ğŸ½ï¸ ë§›ì§‘
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // ìŒì‹/ì¥ì†Œ ê²€ìƒ‰ í•¨ìˆ˜ (REST API)
    function searchFood() {
        const query = document.getElementById('search-food').value.trim();
        
        if (!query) {
            alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            return;
        }
        
        console.log('ê²€ìƒ‰ ì‹œì‘:', query);
        
        // ê²€ìƒ‰ ì¤‘ í‘œì‹œ
        document.getElementById('search-result').innerHTML = `
            <h4>ğŸ” ê²€ìƒ‰ ì¤‘...</h4>
            <p>${query}ë¥¼ ê²€ìƒ‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        `;
        
        // ì„œë²„ì— ê²€ìƒ‰ ìš”ì²­ (REST API) - axios ì‚¬ìš©
        axios.get(`/api/map/search`, {
            params: {
                query: query
            },
            timeout: 10000 // 10ì´ˆ íƒ€ì„ì•„ì›ƒ
        })
        .then(response => {
            console.log('axios ì‘ë‹µ:', response);
            console.log('ì‘ë‹µ ë°ì´í„°:', response.data);
            
            const data = response.data;
            
            if (data.error) {
                // ì—ëŸ¬ ì‘ë‹µ ì²˜ë¦¬
                document.getElementById('search-result').innerHTML = `
                    <h4>âŒ ê²€ìƒ‰ ì˜¤ë¥˜</h4>
                    <p>${data.message || data.error}</p>
                `;
                return;
            }
            
            if (data.addresses && data.addresses.length > 0) {
                // ì²« ë²ˆì§¸ ê²°ê³¼ ì‚¬ìš©
                const firstResult = data.addresses[0];
                console.log('ê²€ìƒ‰ ê²°ê³¼:', firstResult);
                
                // ì§€ë„ ì—…ë°ì´íŠ¸ (REST API ê²°ê³¼ í‘œì‹œ)
                updateMapWithResult(firstResult);
                
                // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
                displaySearchResult(firstResult);
            } else {
                alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                document.getElementById('search-result').innerHTML = `
                    <h4>âŒ ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</h4>
                    <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”.</p>
                `;
            }
        })
        .catch(error => {
            console.error('axios ì˜¤ë¥˜:', error);
            
            if (error.response) {
                // ì„œë²„ì—ì„œ ì‘ë‹µì„ ë°›ì•˜ì§€ë§Œ ì˜¤ë¥˜ ìƒíƒœ
                console.error('ì‘ë‹µ ì˜¤ë¥˜:', error.response.status, error.response.data);
                document.getElementById('search-result').innerHTML = `
                    <h4>âŒ ì„œë²„ ì˜¤ë¥˜</h4>
                    <p>ì„œë²„ ì˜¤ë¥˜ (${error.response.status}): ${error.response.data}</p>
                `;
            } else if (error.request) {
                // ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆì§€ë§Œ ì‘ë‹µì„ ë°›ì§€ ëª»í•¨
                console.error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error.request);
                document.getElementById('search-result').innerHTML = `
                    <h4>âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</h4>
                    <p>ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                `;
            } else {
                // ìš”ì²­ ì„¤ì • ì¤‘ ì˜¤ë¥˜
                console.error('ìš”ì²­ ì˜¤ë¥˜:', error.message);
                document.getElementById('search-result').innerHTML = `
                    <h4>âŒ ìš”ì²­ ì˜¤ë¥˜</h4>
                    <p>${error.message}</p>
                `;
            }
        });
    }

    // REST API ê²°ê³¼ë¡œ ì§€ë„ ì—…ë°ì´íŠ¸
    function updateMapWithResult(result) {
        const mapContainer = document.getElementById('map');
        const lat = parseFloat(result.y);
        const lng = parseFloat(result.x);
        
        mapContainer.innerHTML = `
            <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 15px; display: flex; align-items: center; justify-content: center; color: white; text-align: center; position: relative;">
                <div>
                    <h3 style="margin-bottom: 20px; font-size: 24px;">ğŸ“ ${result.roadAddress || result.jibunAddress}</h3>
                    <p style="margin-bottom: 15px;">ìœ„ë„: ${lat.toFixed(6)}, ê²½ë„: ${lng.toFixed(6)}</p>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <div style="background: rgba(255,255,255,0.3); padding: 8px 12px; border-radius: 20px; font-size: 14px;">
                            ğŸ“ ìœ„ì¹˜ í™•ì¸ë¨
                        </div>
                        <div style="background: rgba(255,255,255,0.3); padding: 8px 12px; border-radius: 20px; font-size: 14px;">
                            ğŸ—ºï¸ ì§€ë„ í‘œì‹œ
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
    function displaySearchResult(result) {
        const resultDiv = document.getElementById('search-result');
        resultDiv.innerHTML = `
            <h4>ğŸ“ ê²€ìƒ‰ ê²°ê³¼</h4>
            <p><strong>${result.roadAddress || result.jibunAddress}</strong></p>
            <p style="font-size: 14px; color: #666;">ìœ„ë„: ${result.y}, ê²½ë„: ${result.x}</p>
        `;
        
        const placeDiv = document.getElementById('place-info');
        placeDiv.innerHTML = `
            <h4>ğŸ½ï¸ ì¥ì†Œ ì •ë³´</h4>
            <p>${result.roadAddress || result.jibunAddress}</p>
        `;
    }
</script>
</html>
