<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LunchBot ë§›ì§‘ ì§€ë„</title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
          font-family: 'Noto Sans KR', sans-serif;
          background: linear-gradient(135deg, #fff3e1 0%, #ffe0b2 100%);
          color: #3b2e25;
        }

        /* âœ… í—¤ë” */
        header {
          background: #ffffff;
          color: #333;
          text-align: center;
          padding: 25px 0 35px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        header h1 {
          font-size: 28px;
          font-weight: 800;
          margin-bottom: 6px;
        }

        header p {
          opacity: 0.8;
          font-size: 15px;
          margin-bottom: 20px;
        }

        /* ğŸ” ê²€ìƒ‰ì°½ */
        .search-box {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 10px;
        }

        .search-box input {
          padding: 10px 15px;
          border: 1px solid #ddd;
          border-radius: 25px;
          width: 250px;
          font-size: 14px;
          outline: none;
          transition: box-shadow 0.2s ease;
        }

        .search-box input:focus {
          box-shadow: 0 0 8px rgba(251,146,60,0.3);
        }

        .search-box button {
          padding: 10px 20px;
          background: #fb923c;
          color: white;
          border: none;
          border-radius: 25px;
          font-weight: 600;
          cursor: pointer;
          transition: background 0.3s ease;
        }

        .search-box button:hover {
          background: #ff7a2e;
        }

        /* ë©”ì¸ */
        .main-wrapper {
          max-width: 1300px;
          margin: 25px auto;
          padding: 0 20px;
          display: grid;
          grid-template-columns: 2fr 1.2fr;
          gap: 25px;
        }

        .upper-content {
          position: relative;
          height: 600px;
          border-radius: 18px;
          overflow: hidden;
          background: linear-gradient(135deg, #fff7e6 0%, #ffe3b0 100%);
          box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        }

        #map {
          width: 100%;
          height: 100%;
          border-radius: 18px;
          filter: saturate(1.1) brightness(1.05);
          transition: all 0.3s ease;
        }

        .upper-content:hover #map {
          filter: saturate(1.25) brightness(1.1);
        }

        .map-title {
          position: absolute;
          top: 15px;
          left: 20px;
          background: rgba(255, 255, 255, 0.8);
          color: #333;
          padding: 10px 18px;
          border-radius: 25px;
          font-weight: 700;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
          backdrop-filter: blur(6px);
          z-index: 10;
        }

        /* ì¶”ì²œ ë§›ì§‘ */
        #restaurant-info {
          background: white;
          border-radius: 15px;
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
          padding: 25px;
          height: 600px;
          overflow-y: auto;
          display: flex;
          flex-direction: column;
        }

        #restaurant-info h3 {
          font-size: 22px;
          font-weight: 800;
          color: #3b2e25;
          border-bottom: 3px solid #fb923c;
          margin-bottom: 15px;
          padding-bottom: 5px;
          text-align: center;
        }

        .restaurant-card {
          background: #fffaf3;
          border: 2px solid transparent;
          border-radius: 10px;
          padding: 15px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.08);
          cursor: pointer;
          transition: all 0.2s ease;
        }

        .restaurant-card:hover {
          border-color: #fb923c;
          transform: translateY(-3px);
          box-shadow: 0 4px 10px rgba(251,146,60,0.2);
        }

        #restaurant-detail {
          margin-top: 20px;
          background: #fff8ed;
          border-radius: 10px;
          padding: 18px;
          border-left: 4px solid #fb923c;
          display: none;
          animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
          .main-wrapper { grid-template-columns: 1fr; }
          #restaurant-info { height: auto; }
        }
    </style>
</head>

<body>
<header>
    <h1>ğŸ± LunchBot ë§›ì§‘ ì§€ë„</h1>
    <p>AIê°€ ë‚´ ì£¼ë³€ ë§›ì§‘ì„ ì°¾ì•„ë“œë¦´ê²Œìš”</p>

    <!-- ğŸ” ê²€ìƒ‰ì°½ -->
    <div class="search-box">
        <input type="text" id="search-input" placeholder="ì˜ˆ: ì´ˆë°¥, ëˆê¹ŒìŠ¤, íŒŒìŠ¤íƒ€">
        <button id="search-btn">ê²€ìƒ‰</button>
    </div>
</header>

<div class="main-wrapper">
    <div class="upper-content">
        <div id="map"></div>
        <div class="map-title">ğŸ“ ë‚´ ì£¼ë³€ ë§›ì§‘ íƒìƒ‰ ì¤‘...</div>
    </div>

    <div id="restaurant-info">
        <h3>AI ì¶”ì²œ ë§›ì§‘ TOP 3</h3>
        <div id="restaurant-list"></div>
        <div id="restaurant-detail"></div>
    </div>
</div>

<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c7620c46bc5355020067ad99447e75f3&libraries=services"></script>
<script>
    let map, userLocation = null, markers = [], infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });

    async function getUserLocation() {
      return new Promise((resolve) => {
        if (!navigator.geolocation) {
          userLocation = { lat: 37.5665, lng: 126.9780 };
          resolve();
          return;
        }
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            userLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            resolve();
          },
          () => {
            userLocation = { lat: 37.5665, lng: 126.9780 };
            resolve();
          }
        );
      });
    }

    function initMap() {
      const center = new kakao.maps.LatLng(userLocation.lat, userLocation.lng);
      const container = document.getElementById("map");
      const options = { center, level: 5 };
      map = new kakao.maps.Map(container, options);

      const marker = new kakao.maps.Marker({ position: center, map });
      const info = new kakao.maps.InfoWindow({
        content: '<div style="padding:5px;font-size:12px;">ğŸ“ ë‚´ ìœ„ì¹˜</div>',
      });
      info.open(map, marker);

      searchPlaces("ë§›ì§‘");
    }

    function searchPlaces(keyword) {
      clearMarkers();
      const ps = new kakao.maps.services.Places();
      const opt = {
        location: new kakao.maps.LatLng(userLocation.lat, userLocation.lng),
        radius: 2000,
        sort: kakao.maps.services.SortBy.DISTANCE,
      };
      ps.keywordSearch(keyword, placesSearchCB, opt);
    }

    function placesSearchCB(data, status) {
      if (status !== kakao.maps.services.Status.OK) {
        alert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      const bounds = new kakao.maps.LatLngBounds();
      data.forEach((d) => bounds.extend(new kakao.maps.LatLng(d.y, d.x)));
      map.setBounds(bounds);

      displayTop3Restaurants(data);
      data.forEach(displayMarker);
    }

    function displayMarker(place) {
      const marker = new kakao.maps.Marker({
        map,
        position: new kakao.maps.LatLng(place.y, place.x),
      });
      markers.push(marker);
      kakao.maps.event.addListener(marker, "click", () => {
        infowindow.setContent(
          `<div style="padding:8px;font-size:12px;"><strong>${place.place_name}</strong><br>${place.road_address_name || place.address_name}</div>`
        );
        infowindow.open(map, marker);
      });
    }

    function clearMarkers() {
      markers.forEach((m) => m.setMap(null));
      markers = [];
      document.getElementById("restaurant-list").innerHTML = "";
      document.getElementById("restaurant-detail").style.display = "none";
    }

    function displayTop3Restaurants(places) {
      const list = document.getElementById("restaurant-list");
      list.innerHTML = "";

      const top3 = places.slice(0, 3);
      top3.forEach((p, i) => {
        const card = document.createElement("div");
        card.className = "restaurant-card";
        card.innerHTML = `
          <h4>${i + 1}ìœ„. ${p.place_name}</h4>
          <p>${p.road_address_name || p.address_name}</p>
          <p class="rating">â­ ${(4 + Math.random()).toFixed(1)}</p>
        `;
        card.addEventListener("click", () => showDetail(p));
        list.appendChild(card);
      });
    }

    function showDetail(place) {
      const detail = document.getElementById("restaurant-detail");
      detail.style.display = "block";
      detail.innerHTML = `
        <h4>${place.place_name}</h4>
        <p>ğŸ“ ì£¼ì†Œ: ${place.road_address_name || place.address_name}</p>
        <p>ğŸ“ ì „í™”ë²ˆí˜¸: ${place.phone || "ì—†ìŒ"}</p>
        <p>ğŸ· ì¹´í…Œê³ ë¦¬: ${place.category_name || "ìŒì‹ì "}</p>
        <p>ğŸŒ ê±°ë¦¬: ì•½ ${(Math.random() * 1.5 + 0.3).toFixed(2)} km</p>
        <p>â­ í‰ì : ${(4 + Math.random()).toFixed(1)}</p>
      `;
    }

    // ğŸ” ê²€ìƒ‰ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
    window.onload = async () => {
      await getUserLocation();
      initMap();

      const searchBtn = document.getElementById("search-btn");
      const searchInput = document.getElementById("search-input");

      searchBtn.addEventListener("click", () => {
        const keyword = searchInput.value.trim();
        if (keyword) searchPlaces(keyword);
        else alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      });

      searchInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          const keyword = searchInput.value.trim();
          if (keyword) searchPlaces(keyword);
          else alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        }
      });
    };
</script>
</body>
</html>
